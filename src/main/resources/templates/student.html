<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–∞—Ç–µ–≥–∏ -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <title>Student Workspace</title>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/student.css}">

    <link rel="icon" href="/images/favicon.ico">

</head>
<body th:data-user-id="${#authentication.principal.id}">

<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- ‚úÖ –ö–ù–û–ü–ö–ê –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø SIDEBAR -->
<button id="sidebarToggle" onclick="toggleSidebar()">‚ò∞</button>

<div class="app-layout">

    <!-- SIDEBAR -->
    <aside id="studentSidebar" class="sidebar">

        <div class="sidebar-header">
            <h6>Student Panel</h6>
        </div>

        <div class="sidebar-body">

            <button class="menu-btn" onclick="loadMembershipGroups()">
                A'zolik
            </button>

            <div class="list-membership-groups"></div>

            <button class="menu-btn" onclick="loadInvites()">
                Gruppaga taklif
            </button>

            <button class="menu-btn" onclick="loadTasks()">
                Vazifalar
            </button>

            <button class="menu-btn" onclick="loadStatistics()">
                Statistika
            </button>

        </div>

    </aside>

    <!-- MAIN WORKSPACE -->
    <main class="workspace">

        <div class="workspace-header">
            <h5 id="workspaceTitle">Xush kelibsiz</h5>
        </div>

        <div id="workspaceContent" class="workspace-body">

            <div class="center-msg">
                Yon paneldan bo'limni tanlang
            </div>

        </div>

    </main>

</div>


<!--–ú–æ–¥–∞–ª —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –æ—à–∏–±–∫–∏-->
<div class="modal fade"
     id="errorModal"
     tabindex="-1"
     aria-labelledby="errorModalLabel"
     aria-hidden="true">

    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header bg-danger text-white">
                <h5 id="errorModalLabel">Xatolik</h5>
            </div>

            <div class="modal-body" id="errorText"></div>

            <div class="modal-footer">
                <button class="btn btn-secondary"
                        data-bs-dismiss="modal">
                    Tushunarli
                </button>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="taskModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title d-flex align-items-center gap-2">

                    <span id="taskSetName"
                          class="badge bg-info-subtle text-info-emphasis border border-info-subtle">
                        ‚Äî
                    </span>
                </h5>

                <div id="taskProgressbar" class="progress mb-2" style="flex:1">
                    <div id="taskProgress" class="progress-bar" style="width:0%"></div>
                </div>

                <div id="taskTimer" class="ms-3 fw-bold text-primary">
                    ‚è± 00:00
                </div>

                <!-- RESULT SUMMARY -->
                <div id="resultSummary"
                     class="mt-2 w-100 small"
                     style="display:none;">
                </div>

                <div class="d-flex gap-2">

                    <button id="finishBtn" class="btn btn-danger btn-sm" onclick="finishTaskSession()">
                        Tugatish
                    </button>
                    <button id="syncBtn" class="btn btn-warning btn-sm" onclick="manualSaveAttempt()">
                        Holatni saqlash
                    </button>
                </div>

                <button type="button" class="btn-close"
                        data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <!-- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤ —Ç–µ–ø–µ—Ä—å div -->
                <div id="taskQuestionsBody"></div>
            </div>

            <div id="modal-footer" class="modal-footer d-flex justify-content-between">
                <div class="exam-nav">
                    <button id="prevBtn" class="btn btn-outline-secondary btn-sm" onclick="prevQuestion()">
                        ‚óÄ Oldingi
                    </button>
                    <button id="nextBtn" class="btn btn-outline-secondary btn-sm" onclick="nextQuestion()">
                        Keyingi ‚ñ∂
                    </button>
                </div>

                <button class="btn btn-secondary" data-bs-dismiss="modal">
                    Yopish
                </button>
            </div>

        </div>
    </div>
</div>

<!--Chat modal (simple MVP)-->
<div class="modal fade" id="chatModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üí¨ Topshiriq bo'yicha chat</h5>

                <div class="ms-auto d-flex gap-2 align-items-center">

                    <!-- Fullscreen -->
                    <button type="button"
                            class="btn btn-sm btn-outline-secondary"
                            id="chatFullscreenBtn"
                            onclick="toggleChatFullscreen()">
                        üî≤
                    </button>

                    <!-- Close -->
                    <button type="button"
                            class="btn-close"
                            data-bs-dismiss="modal">
                    </button>

                </div>
            </div>
            <div class="modal-body">

                <div class="modal-container">
                    <div id="chatContainer"></div>
                    <textarea id="chatInput"
                              class="form-control"
                              rows="1"
                              placeholder="Xabar yozing..."
                              style="resize: none;margin-top: 10px;"></textarea>
                    <button class="btn btn-primary mt-2" onclick="sendMessage()">‚úâÔ∏è Send</button>
                </div>

            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/navbar.js}"></script>
<script th:src="@{/js/student/student.js}"></script>
<script th:src="@{/js/student/student-task.js}"></script>
</body>
</html>
